<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title>three.js css3d - primitives - box</title>
		<style>
			html, body {
				height: 100%;
			}

			body {
				background-color: white;
				margin: 0;
				font-family: Arial;
				overflow: hidden;
			}

			.three-box-container.red .three-box .side { background:rgba(125,0,0,0.5); }
			.three-box-container.blue .three-box .side { background:rgba(0,0,125,0.5); }
			.three-box-container.green .three-box .side { background:rgba(0,125,0,0.5); }
			.three-box-container.purple .three-box .side { background:rgba(148,0,211,0.5); }
			.three-box-container.yellow .three-box .side { background:rgba(255,255,0,0.5); }
			.three-box-container.pink .three-box .side { background:rgba(255,125,255,0.5); }


		</style>
	</head>
	<body>
		<div id="container"></div>

		<script src="../build/three.min.js"></script>
		<script src="js/libs/stats.min.js"></script>
		<script src="js/libs/tween.min.js"></script>
		<script src="js/renderers/CSS3DRenderer.js"></script>
		<script src="js/CSS3DPrimitives.js"></script>

		<script>
			var container, stats;
			var camera, scene, projector, renderer;
			var boxColorClassNames = ["red","blue","green","purple","yellow","pink"];

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				var info = document.createElement( 'div' );
				info.style.position = 'absolute';
				info.style.top = '10px';
				info.style.width = '100%';
				info.style.textAlign = 'center';
				info.innerHTML = '<a href="http://threejs.org" target="_blank">three.js</a> - <strong>css3d</strong> clickable objects';
				container.appendChild( info );

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.y = 300;
				camera.position.z = 700;

				scene = new THREE.Scene();

				for ( var i = 0; i < 20; i ++ ) {

					var object = new THREE.CSS3D.Primitives.Box(100,100,100);
					object.element.setAttribute("id","box-" + i);
					object.element.classList.add(boxColorClassNames[Math.floor(Math.random() * boxColorClassNames.length)]);
					object.position.x = Math.random() * 800 - 400;
					object.position.y = Math.random() * 800 - 400;
					object.position.z = Math.random() * 800 - 400;
					object.scale.x = Math.random() * 2 + 1;
					object.scale.y = Math.random() * 2 + 1;
					object.scale.z = Math.random() * 2 + 1;
					object.rotation.x = Math.random() * 2 * Math.PI;
					object.rotation.y = Math.random() * 2 * Math.PI;
					object.rotation.z = Math.random() * 2 * Math.PI;

					object.element.addEventListener('click',onMouseDown,false);

					scene.add( object );
				}

				projector = new THREE.Projector();

				renderer = new THREE.CSS3DRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );

				container.appendChild(renderer.domElement);

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				container.appendChild( stats.domElement );

				//

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function onMouseDown( event ) {
				event.preventDefault();

				for(var i=0;i<scene.children.length;i++) {
					if(scene.children[i].element == event.target) {
						tweenObject(scene.children[i]);
						return;
					}

					for(var j=0;j<scene.children[i].element.firstChild.childNodes.length;j++) {
						if(scene.children[i].element.firstChild.childNodes[j] == event.target) {
							tweenObject(scene.children[i]);
							return;					
						}
					}
				}
			}

			function tweenObject(object) {
				new TWEEN.Tween( object.position ).to( {
					x: Math.random() * 800 - 400,
					y: Math.random() * 800 - 400,
					z: Math.random() * 800 - 400 }, 2000 )
				.easing( TWEEN.Easing.Elastic.Out).start();

				new TWEEN.Tween( object.rotation ).to( {
					x: Math.random() * 2 * Math.PI,
					y: Math.random() * 2 * Math.PI,
					z: Math.random() * 2 * Math.PI }, 2000 )
				.easing( TWEEN.Easing.Elastic.Out).start();
			}

			//

			function animate() {

				requestAnimationFrame( animate );

				render();
				stats.update();

			}

			var radius = 600;
			var theta = 0;

			function render() {

				TWEEN.update();

				theta += 0.1;

				camera.position.x = radius * Math.sin( THREE.Math.degToRad( theta ) );
				camera.position.y = radius * Math.sin( THREE.Math.degToRad( theta ) );
				camera.position.z = radius * Math.cos( THREE.Math.degToRad( theta ) );
				camera.lookAt( scene.position );

				renderer.render( scene, camera );

			}
		</script>
	</body>
</html>
